define(["fullscreen"],function(o){function e(){p=new Stats,p.domElement.style.position="absolute",p.domElement.style.top="auto",document.getElementsByClassName("canvas")[0].appendChild(p.domElement)}function t(){p.begin(),f.render(c,_),p.end()}function n(){window.requestAnimationFrame(n),t()}function i(o,e){$(".canvas").css({width:o+"px",height:e+"px"}),$("#canvas-model-preview").css({width:o+"px",height:e+"px"}),f.setSize(o,e),t()}console.log("PC端模型预览改版!!!");var a=window.outerWidth,d=window.outerHeight,l=a/d,s=$(".col-md-9").width(),r=s/l,c=new THREE.Scene,p=null,m="";e(),console.log("是否支持配置:",is_model_option),is_model_option,THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var v=new THREE.MTLLoader;v.setBaseUrl("http://7xs7nv.com1.z0.glb.clouddn.com/"),v.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),v.crossOrigin="*",v.setMaterialOptions({side:THREE.DoubleSide}),v.load(mtlUrl,function(o){o.preload();var e=new THREE.OBJLoader;e.setMaterials(o),e.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),e.load(objUrl,function(o){m=o,m.scale.set(model_option[0],model_option[0],model_option[0]),m.rotation.x=model_option[1]/180*Math.PI,m.rotation.y=model_option[2]/180*Math.PI,m.rotation.z=model_option[3]/180*Math.PI,m.position.set(model_option[4]||0,model_option[5]||0,model_option[6]||0),c.add(m),$(".canvas-model-preview .preview-img").remove(),$(".canvas-model-preview .progress").remove(),t()},b,H)});var h=new THREE.PointLight(16777215);h.position.set(-100,200,-100),c.add(h);var u=new THREE.DirectionalLight(16772829);u.position.set(0,0,1).normalize(),c.add(u);var w=new THREE.SpotLight(16777215,1.75,2e3,Math.PI/3);w.position.set(0,500,500),w.target.position.set(0,0,0),w.castShadow=!0,c.add(w);var E=new THREE.SpotLight(16777215,1.75,2e3,Math.PI/3);E.position.set(500,0,300),E.target.position.set(0,0,0),E.castShadow=!0,c.add(E);var g=new THREE.SpotLight(16777215,1.75,2e3,Math.PI/3);g.position.set(-360,-360,500),g.target.position.set(0,0,0),g.castShadow=!0,c.add(g),c.add(new THREE.AmbientLight(4473924));var _=new THREE.PerspectiveCamera(45,l,.1,1e3);_.position.set(200,200,200),_.lookAt(c.position);var f=new THREE.WebGLRenderer({antialiasing:!0,alpha:!0});f.setPixelRatio(window.devicePixelRatio),f.setSize(s,r),f.domElement.id="canvas-model-preview",$(".canvas").append(f.domElement);var R=new THREE.OrbitControls(_,document.querySelector("#canvas-model-preview"));R.addEventListener("change",t);var b=function(o){if(o.lengthComputable){var e=o.loaded/o.total*100;$(".progress-bar").css("width",Math.round(e,2)+"%"),console.log(Math.round(e,2)+"% downloaded")}},H=function(o){};n();var P=!1;$(".fullscreen").on("click",function(){P?(i(s,r),o.exitFull()):(console.log("full"),o.full(document.getElementsByClassName("canvas")[0]),i(a,d)),P=!P}),document.addEventListener("keydown",function(o){27==o.which&&(console.log("退出全屏"),i(s,r))});var T=model_option;for(var y in T)$(".model_option_"+y).val(T[y]||0);$(".panel-body input").on("change",function(){console.log("模型配置");for(var o in T)T[o]=$(".model_option_"+o).val();m.scale.set(T[0],T[0],T[0]),m.rotation.x=T[1]/180*Math.PI,m.rotation.y=T[2]/180*Math.PI,m.rotation.z=T[3]/180*Math.PI,m.position.set(T[4],T[5],T[6])});var L="",M="";new RegExp(location.pathname).test("admin")?(L="/admin/update_model_option",M="/admin/edit_model_message"):(L="/models/web/update_model_option",M="/models/web/edit_model_message"),$("#update_model_option").on("click",function(){if(confirm("确认更新配置")){var o={model_id:model_id,model_option:JSON.stringify(T)};$.post(L,o,function(o){alert(o)})}}),$(".btn-edit").on("click",function(){$(".panel_popup").addClass("show")}),$(".btn-model-save").on("click",function(){var o={name:$("#edit-name").val(),descriptions:$("#edit-descriptions").val(),typeId:$("#edit-typeId").val()};$.post(M,o,function(e){alert(e),$("#model_name").html(o.name),$("#model_descriptions").html(o.descriptions),$("#model_typeId").html(o.typeId)})}),$(".btn-cancal").on("click",function(){$(".panel_popup").addClass("show")})});