define([],function(){function o(){d=new Stats,d.domElement.style.position="absolute",d.domElement.style.top="auto",document.body.appendChild(d.domElement)}function e(){d.begin(),_.render(a,v),d.end()}function n(){window.requestAnimationFrame(n),e()}console.log("PC端模型预览改版!!!");var t=$(".col-md-9").width(),i=t/1.5,a=new THREE.Scene,d=(new THREE.Clock,null),l="";o();var r=new THREE.AxisHelper(100);a.add(r),THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var m=new THREE.MTLLoader;m.setBaseUrl("http://7xs7nv.com1.z0.glb.clouddn.com/"),m.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),m.crossOrigin="*",m.load(mtlUrl,function(o){o.preload();var e=new THREE.OBJLoader;e.setMaterials(o),e.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),e.load(objUrl,function(o){l=o,l.scale.set(model_option[0],model_option[0],model_option[0]),l.rotation.x=model_option[1]/180*Math.PI,l.rotation.y=model_option[2]/180*Math.PI,l.rotation.z=model_option[3]/180*Math.PI,a.add(l),$(".canvas-model-preview .preview-img").remove(),$(".canvas-model-preview .progress").remove()},u,w)});var s=new THREE.PointLight(16777215);s.position.set(-100,200,-100),a.add(s);var p=new THREE.DirectionalLight(16772829);p.position.set(0,0,1).normalize(),a.add(p);var c=new THREE.SpotLight(16777215);c.position.z=70,c.castShadow=!0,a.add(c),a.add(new THREE.AmbientLight(1052720));var v=new THREE.PerspectiveCamera(45,t/i,.1,1e3);v.position.set(200,200,200),v.lookAt(a.position);var _=new THREE.WebGLRenderer({antialiasing:!0});_.setSize(t,i),$(".canvas-model-preview").append(_.domElement);var E=new THREE.OrbitControls(v,document.querySelector(".canvas-model-preview"));E.addEventListener("change",e),n();var u=function(o){if(o.lengthComputable){var e=o.loaded/o.total*100;$(".progress-bar").css("width",Math.round(e,2)+"%"),console.log(Math.round(e,2)+"% downloaded")}},w=function(o){};$(".model_option_1").val(model_option[0]),$(".model_option_2").val(model_option[1]),$(".model_option_3").val(model_option[2]),$(".model_option_4").val(model_option[3]);var h=model_option;$(".panel-body input").on("change",function(){console.log("模型配置"),h[0]=$(".model_option_1").val(),h[1]=$(".model_option_2").val(),h[2]=$(".model_option_3").val(),h[3]=$(".model_option_4").val(),l.scale.set(h[0],h[0],h[0]),l.rotation.x=h[1]/180*Math.PI,l.rotation.y=h[2]/180*Math.PI,l.rotation.z=h[3]/180*Math.PI}),$("#update_model_option").on("click",function(){if(confirm("确认更新配置")){var o={model_id:model_id,model_option:JSON.stringify(h)};$.post("/models/web/update_model_option",o,function(o){alert(o)})}})});