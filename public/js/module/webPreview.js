define([],function(){function o(){d=new Stats,d.domElement.style.position="absolute",d.domElement.style.top="auto",document.body.appendChild(d.domElement)}function e(){d.begin(),h.render(a,w),d.end()}function t(){window.requestAnimationFrame(t),e()}console.log("PC端模型预览改版!!!");var n=$(".col-md-9").width(),i=n/1.5,a=new THREE.Scene,d=(new THREE.Clock,null),l="";o();var r=new THREE.AxisHelper(100);a.add(r),THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var s=new THREE.MTLLoader;s.setBaseUrl("http://7xs7nv.com1.z0.glb.clouddn.com/"),s.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),s.crossOrigin="*",s.load(mtlUrl,function(o){o.preload();var e=new THREE.OBJLoader;e.setMaterials(o),e.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),e.load(objUrl,function(o){l=o,l.scale.set(model_option[0],model_option[0],model_option[0]),l.rotation.x=model_option[1]/180*Math.PI,l.rotation.y=model_option[2]/180*Math.PI,l.rotation.z=model_option[3]/180*Math.PI,l.position.set(model_option[4]||0,model_option[5]||0,model_option[6]||0),a.add(l),$(".canvas-model-preview .preview-img").remove(),$(".canvas-model-preview .progress").remove()},g,_)});var p=new THREE.PointLight(16777215);p.position.set(-100,200,-100),a.add(p);var m=new THREE.DirectionalLight(16772829);m.position.set(0,0,1).normalize(),a.add(m);var c=new THREE.SpotLight(16777215);c.position.set(-353,-353,500),c.castShadow=!0,a.add(c);var E=new THREE.SpotLight(16777215);E.position.set(-130,483,300),E.castShadow=!0,a.add(E);var v=new THREE.SpotLight(16777215);v.position.set(483,-130,300),v.castShadow=!0,a.add(v),a.add(new THREE.AmbientLight(1052720));var w=new THREE.PerspectiveCamera(45,n/i,.1,1e3);w.position.set(200,200,200),w.lookAt(a.position);var h=new THREE.WebGLRenderer({antialiasing:!0});h.setSize(n,i),$(".canvas-model-preview").append(h.domElement);var u=new THREE.OrbitControls(w,document.querySelector(".canvas-model-preview"));u.addEventListener("change",e),t();var g=function(o){if(o.lengthComputable){var e=o.loaded/o.total*100;$(".progress-bar").css("width",Math.round(e,2)+"%"),console.log(Math.round(e,2)+"% downloaded")}},_=function(o){},f=model_option;for(var H in f)$(".model_option_"+H).val(f[H]||0);$(".panel-body input").on("change",function(){console.log("模型配置");for(var o in f)f[o]=$(".model_option_"+o).val();l.scale.set(f[0],f[0],f[0]),l.rotation.x=f[1]/180*Math.PI,l.rotation.y=f[2]/180*Math.PI,l.rotation.z=f[3]/180*Math.PI,l.position.set(f[4],f[5],f[6])}),$("#update_model_option").on("click",function(){if(confirm("确认更新配置")){var o={model_id:model_id,model_option:JSON.stringify(f)};$.post("/models/web/update_model_option",o,function(o){alert(o)})}})});