define([],function(){function o(){d=new Stats,d.domElement.style.position="absolute",d.domElement.style.top="auto",document.body.appendChild(d.domElement)}function e(){d.begin(),w.render(i,_),d.end()}function t(){window.requestAnimationFrame(t),e()}console.log("PC端模型预览改版!!!");var n=$(".col-md-9").width(),a=n/1.5,i=new THREE.Scene,d=(new THREE.Clock,null),l="";o();var r=new THREE.AxisHelper(100);i.add(r),THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var s=new THREE.MTLLoader;s.setBaseUrl("http://7xs7nv.com1.z0.glb.clouddn.com/"),s.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),s.crossOrigin="*",s.load(mtlUrl,function(o){o.preload();var e=new THREE.OBJLoader;e.setMaterials(o),e.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),e.load(objUrl,function(o){l=o,l.scale.set(model_option[0],model_option[0],model_option[0]),l.rotation.x=model_option[1]/180*Math.PI,l.rotation.y=model_option[2]/180*Math.PI,l.rotation.z=model_option[3]/180*Math.PI,i.add(l),$(".canvas-model-preview .preview-img").remove(),$(".canvas-model-preview .progress").remove()},u,g)});var m=new THREE.PointLight(16777215);m.position.set(-100,200,-100),i.add(m);var p=new THREE.DirectionalLight(16772829);p.position.set(0,0,1).normalize(),i.add(p);var c=new THREE.SpotLight(16777215);c.position.set(-353,-353,500),c.castShadow=!0,i.add(c);var v=new THREE.SpotLight(16777215);v.position.set(-130,483,300),v.castShadow=!0,i.add(v);var E=new THREE.SpotLight(16777215);E.position.set(483,-130,300),E.castShadow=!0,i.add(E),i.add(new THREE.AmbientLight(1052720));var _=new THREE.PerspectiveCamera(45,n/a,.1,1e3);_.position.set(200,200,200),_.lookAt(i.position);var w=new THREE.WebGLRenderer({antialiasing:!0});w.setSize(n,a),$(".canvas-model-preview").append(w.domElement);var h=new THREE.OrbitControls(_,document.querySelector(".canvas-model-preview"));h.addEventListener("change",e),t();var u=function(o){if(o.lengthComputable){var e=o.loaded/o.total*100;$(".progress-bar").css("width",Math.round(e,2)+"%"),console.log(Math.round(e,2)+"% downloaded")}},g=function(o){};$(".model_option_1").val(model_option[0]),$(".model_option_2").val(model_option[1]),$(".model_option_3").val(model_option[2]),$(".model_option_4").val(model_option[3]);var H=model_option;$(".panel-body input").on("change",function(){console.log("模型配置"),H[0]=$(".model_option_1").val(),H[1]=$(".model_option_2").val(),H[2]=$(".model_option_3").val(),H[3]=$(".model_option_4").val(),l.scale.set(H[0],H[0],H[0]),l.rotation.x=H[1]/180*Math.PI,l.rotation.y=H[2]/180*Math.PI,l.rotation.z=H[3]/180*Math.PI}),$("#update_model_option").on("click",function(){if(confirm("确认更新配置")){var o={model_id:model_id,model_option:JSON.stringify(H)};$.post("/models/web/update_model_option",o,function(o){alert(o)})}})});