define(["fullscreen"],function(o){function e(){c=new Stats,c.domElement.style.position="absolute",c.domElement.style.top="auto",document.getElementsByClassName("canvas")[0].appendChild(c.domElement)}function t(){c.begin(),_.render(r,f),c.end()}function n(o,e){$(".canvas").css({width:o+"px",height:e+"px"}),$("#canvas-model-preview").css({width:o+"px",height:e+"px"}),_.setSize(o,e)}console.log("PC端模型预览改版!!!");var i=window.outerWidth,a=window.outerHeight,d=i/a,l=$(".col-md-9").width(),s=l/d,r=new THREE.Scene,c=(new THREE.Clock,null),m="";if(e(),console.log("是否支持配置:",is_model_option),is_model_option){var p=new THREE.AxisHelper(100);r.add(p)}THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var v=new THREE.MTLLoader;v.setBaseUrl("http://7xs7nv.com1.z0.glb.clouddn.com/"),v.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),v.crossOrigin="*",v.load(mtlUrl,function(o){o.preload();var e=new THREE.OBJLoader;e.setMaterials(o),e.setPath("http://7xs7nv.com1.z0.glb.clouddn.com/"),e.load(objUrl,function(o){m=o,m.scale.set(model_option[0],model_option[0],model_option[0]),m.rotation.x=model_option[1]/180*Math.PI,m.rotation.y=model_option[2]/180*Math.PI,m.rotation.z=model_option[3]/180*Math.PI,m.position.set(model_option[4]||0,model_option[5]||0,model_option[6]||0),r.add(m),$(".canvas-model-preview .preview-img").remove(),$(".canvas-model-preview .progress").remove(),t()},R,T)});var E=new THREE.PointLight(16777215);E.position.set(-100,200,-100),r.add(E);var h=new THREE.DirectionalLight(16772829);h.position.set(0,0,1).normalize(),r.add(h);var u=new THREE.SpotLight(16777215);u.position.set(-353,-353,500),u.castShadow=!0,r.add(u);var w=new THREE.SpotLight(16777215);w.position.set(-130,483,300),w.castShadow=!0,r.add(w);var g=new THREE.SpotLight(16777215);g.position.set(483,-130,300),g.castShadow=!0,r.add(g),r.add(new THREE.AmbientLight(1052720));var f=new THREE.PerspectiveCamera(45,d,.1,1e3);f.position.set(200,200,200),f.lookAt(r.position);var _=new THREE.WebGLRenderer({antialiasing:!0});_.setSize(l,s),_.domElement.id="canvas-model-preview",$(".canvas").append(_.domElement);var H=new THREE.OrbitControls(f,document.querySelector("#canvas-model-preview"));H.addEventListener("change",t);var R=function(o){if(o.lengthComputable){var e=o.loaded/o.total*100;$(".progress-bar").css("width",Math.round(e,2)+"%"),console.log(Math.round(e,2)+"% downloaded")}},T=function(o){},L=model_option;for(var b in L)$(".model_option_"+b).val(L[b]||0);$(".panel-body input").on("change",function(){console.log("模型配置");for(var o in L)L[o]=$(".model_option_"+o).val();m.scale.set(L[0],L[0],L[0]),m.rotation.x=L[1]/180*Math.PI,m.rotation.y=L[2]/180*Math.PI,m.rotation.z=L[3]/180*Math.PI,m.position.set(L[4],L[5],L[6])}),$("#update_model_option").on("click",function(){if(confirm("确认更新配置")){var o={model_id:model_id,model_option:JSON.stringify(L)};$.post("/models/web/update_model_option",o,function(o){alert(o)})}});var S=!1;$(".fullscreen").on("click",function(){S?(n(l,s),o.exitFull()):(console.log("full"),o.full(document.getElementsByClassName("canvas")[0]),n(i,a)),S=!S}),document.addEventListener("keydown",function(o){27==o.which&&(console.log("退出全屏"),n(l,s))})});