define(["util"],function(e){function t(e,t){u=!1,plupload.each(t,function(t){d.show().html("加载中"),e.start();var n=new FileReader;n.onload=function(){$("#previewImg").show().attr("src",this.result)},n.readAsDataURL(t.getSource().getSource())})}function n(e,t,n){var a=JSON.parse(n);s.previewImg="http://7xs7nv.com1.z0.glb.clouddn.com/"+a.key,$("#progress").html(t.name+"上传成功！"),u=!0}function a(e,t){g=!1,plupload.each(t,function(t){d.show().html("加载中"),e.start();var n=new FileReader;n.readAsDataURL(t.getSource().getSource())})}function i(e,t,n){var a=JSON.parse(n);s.objUrl=a.key,s.objName=t.name,$("#progress").html(t.name+"上传成功！"),$("#obj-text").html(t.name),g=!0}function o(e,t){p=!1,plupload.each(t,function(t){d.show().html("加载中"),e.start();var n=new FileReader;n.readAsDataURL(t.getSource().getSource())})}function r(e,t,n){var a=JSON.parse(n);s.mtlUrl=a.key,s.mtlName=t.name,$("#progress").html(t.name+"上传成功！"),$("#mtl-text").html(t.name),p=!0}function l(e,t){c=!1,plupload.each(t,function(t){d.show().html("加载中"),e.start();var n=new FileReader;n.onload=function(){$(".imgList").append('<img src="'+this.result+'" width="180px">')},n.readAsDataURL(t.getSource().getSource())})}function m(e,t,n){var a=JSON.parse(n);s.imgUrl.push(a.key),s.imgName.push(t.name),$("#progress").html(t.name+"上传成功！"),c=!0}console.log("上传模块加载完成");var s={modelName:"",descriptions:"",previewImg:"",typeId:1,objUrl:"",objName:"",mtlUrl:"",mtlName:"",imgUrl:[],imgName:[]},d=$("#progress"),u=!0,g=!0,p=!0,c=!0;$.get("/qiniu/token",function(s){e.initQiniu(s,"btn_add_preview","模型预览图","jpg,png,gif,jpeg",t,n,d),e.initQiniu(s,"btn_add_obj","模型obj文件","obj",a,i,d),e.initQiniu(s,"btn_add_mtl","模型mtl文件","mtl",o,r,d),e.initQiniu(s,"btn_add_img","模型贴图文件","jpg,png,tga,jpeg,dds",l,m,d)}),$("#upload-model").on("click",function(){if(s.modelName=$("#model_name").val(),s.descriptions=$("#model_descriptions").val(),s.typeId=$("#model_type").val(),console.log(s),u&&p&&g&&c){if(!s.modelName)return void e.shake("#model_name");if(!s.previewImg)return void e.shake("#btn_add_preview");if(!s.objUrl)return void e.shake("#btn_add_obj");if(!s.mtlUrl)return void e.shake("#btn_add_mtl");if(!s.imgUrl)return void e.shake("#btn_add_img");s.imgUrl=JSON.stringify(s.imgUrl),s.imgName=JSON.stringify(s.imgName),$.post("/models/upload",s,function(e){alert(e),location.href="/users/message"})}else alert("上传中稍等。。。")})});