define(["util"],function(e){function t(e,t){u=!1,plupload.each(t,function(t){s.show().html("加载中"),e.start();var n=new FileReader;n.onload=function(){$("#previewImg").show().attr("src",this.result)},n.readAsDataURL(t.getSource().getSource())})}function n(e,t,n){var o=JSON.parse(n);d.previewImg="http://7xs7nv.com1.z0.glb.clouddn.com/"+o.key,$("#progress").html(t.name+"上传成功！"),u=!0}function o(e,t){c=!1,plupload.each(t,function(t){s.show().html("加载中"),e.start();var n=new FileReader;n.readAsDataURL(t.getSource().getSource())})}function a(e,t,n){var o=JSON.parse(n);d.objUrl="http://7xs7nv.com1.z0.glb.clouddn.com/"+o.key,d.objName=t.name,$("#progress").html(t.name+"上传成功！"),$("#obj-text").html(t.name),c=!0}function i(e,t){g=!1,plupload.each(t,function(t){s.show().html("加载中"),e.start();var n=new FileReader;n.readAsDataURL(t.getSource().getSource())})}function r(e,t,n){var o=JSON.parse(n);d.mtlUrl="http://7xs7nv.com1.z0.glb.clouddn.com/"+o.key,d.mtlName=t.name,$("#progress").html(t.name+"上传成功！"),$("#mtl-text").html(t.name),g=!0}function l(e,t){p=!1,plupload.each(t,function(t){s.show().html("加载中"),e.start();var n=new FileReader;n.onload=function(){$(".imgList").append('<img src="'+this.result+'" width="180px">')},n.readAsDataURL(t.getSource().getSource())})}function m(e,t,n){var o=JSON.parse(n);d.imgUrl+=o.key,d.imgUrl+=",",d.imgName+=t.name,d.imgName+=",",$("#progress").html(t.name+"上传成功！"),p=!0}console.log("上传模块加载完成");var d={modelName:"",descriptions:"",previewImg:"",typeId:1,objUrl:"",objName:"",mtlUrl:"",mtlName:"",imgUrl:"",imgName:""},s=$("#progress"),u=!0,c=!0,g=!0,p=!0;$.get("/qiniu/token",function(d){e.initQiniu(d,"btn_add_preview","模型预览图","jpg,png",t,n,s),e.initQiniu(d,"btn_add_obj","模型obj文件","obj",o,a,s),e.initQiniu(d,"btn_add_mtl","模型mtl文件","mtl",i,r,s),e.initQiniu(d,"btn_add_img","模型贴图文件","jpg,png",l,m,s)}),$("#upload-model").on("click",function(){if(d.modelName=$("#model_name").val(),d.descriptions=$("#model_descriptions").val(),d.typeId=$("#model_type").val(),console.log(d),u&&g&&c&&p){if(!d.modelName)return void e.shake("#model_name");if(!d.previewImg)return void e.shake("#btn_add_preview");if(!d.objUrl)return void e.shake("#btn_add_obj");if(!d.mtlUrl)return void e.shake("#btn_add_mtl");if(!d.imgUrl)return void e.shake("#btn_add_img");d.imgUrl=d.imgUrl.substring(0,d.imgUrl.length-1),d.imgName=d.imgName.substring(0,d.imgName.length-1),$.post("/models/upload",d,function(e){alert(e)})}else alert("上传中稍等。。。")})});