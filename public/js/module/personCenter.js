define(["util","tplM"],function(e,s){function o(){$(".panel_reset_password input").val(""),$(".panel_reset_password").removeClass("show")}function a(e,s){t=!1,plupload.each(s,function(s){l.show().html("加载中"),e.start();var o=new FileReader;o.onload=function(){$("#user_avatar").attr("src",this.result)},o.readAsDataURL(s.getSource().getSource())})}function n(e,s,o){var a=JSON.parse(o);r.avatar="http://7xs7nv.com1.z0.glb.clouddn.com/"+a.key,$("#progress").html(s.name+"上传成功！"),t=!0,console.log(a)}var r=user,t=!0;$("#user_sex").val(r.sex),$("#btn_update_message").on("click",function(){var s=$("#user_name").val(),o=$("#user_mobile").val();return s?o?(r.name=r.name,r.mobile=o,r.sex=$("#user_sex").val(),r.birthday=$("#user_birthday").val(),console.log(r),t?$.post("/users/update",r,function(e){alert(e),location.reload()}):e.shake("#btn_update_message"),!1):void e.shake("#user_mobile"):void e.shake("#user_name")}),$("#btn_reset_password").on("click",function(){$(".panel_reset_password").addClass("show")}),$("#btn_reset_password_1").on("click",function(){console.log("重置");var s=$("#old_password").val(),a=$("#new_password_1").val(),n=$("#new_password_2").val();return s?!a||a.length<6?void e.shake("#new_password_1"):n?a!==n?(e.shake("#new_password_1"),void e.shake("#new_password_2")):void $.post("/users/resetPassword",{oldPassword:s,newPassword1:a,newPassword2:n},function(e){alert(e),o()}):void e.shake("#new_password_2"):void e.shake("#old_password")}),$("#btn_reset_password_2").on("click",function(){o()});var l=$("#progress");$.get("/qiniu/token",function(s){e.initQiniu(s,"btn_add_avatar","头像","jpg,png",a,n,l)}),$.get("/models/userfind",function(e){if(console.log(e),e){var s=$.tpl("tpl",{model:e});$(".user-model-list").html(s)}else $(".user-model-list").html("您还没上传作品")})});