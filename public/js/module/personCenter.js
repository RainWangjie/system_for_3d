define(["util"],function(s){function e(){$(".panel_reset_password input").val(""),$(".panel_reset_password").removeClass("show")}function a(s,e){r=!1,plupload.each(e,function(e){t.show().html("加载中"),s.start();var a=new FileReader;a.onload=function(){$("#user_avatar").attr("src",this.result)},a.readAsDataURL(e.getSource().getSource())})}function o(s,e,a){var o=JSON.parse(a);n.avatar="http://7xs7nv.com1.z0.glb.clouddn.com/"+o.key,$("#progress").html(e.name+"上传成功！"),r=!0,console.log(o)}var n=user,r=!0;$("#user_sex").val(n.sex),$("#btn_update_message").on("click",function(){var e=$("#user_name").val(),a=$("#user_mobile").val();return e?a?(n.name=n.name,n.mobile=a,n.sex=$("#user_sex").val(),n.birthday=$("#user_birthday").val(),console.log(n),r?$.post("/users/update",n,function(s){alert(s),location.reload()}):s.shake("#btn_update_message"),!1):void s.shake("#user_mobile"):void s.shake("#user_name")}),$("#btn_reset_password").on("click",function(){$(".panel_reset_password").addClass("show")}),$("#btn_reset_password_1").on("click",function(){console.log("重置");var a=$("#old_password").val(),o=$("#new_password_1").val(),n=$("#new_password_2").val();return a?!o||o.length<6?void s.shake("#new_password_1"):n?o!==n?(s.shake("#new_password_1"),void s.shake("#new_password_2")):void $.post("/users/resetPassword",{oldPassword:a,newPassword1:o,newPassword2:n},function(s){alert(s),e()}):void s.shake("#new_password_2"):void s.shake("#old_password")}),$("#btn_reset_password_2").on("click",function(){e()});var t=$("#progress");$.get("/qiniu/token",function(e){s.initQiniu(e,"btn_add_avatar","头像","jpg,png",a,o,t)})});