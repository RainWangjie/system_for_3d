define(["util","tplM"],function(e){function s(){$(".panel_reset_password input").val(""),$(".panel_reset_password").removeClass("show")}function o(e,s){t=!1,plupload.each(s,function(s){r.show().html("加载中"),e.start();var o=new FileReader;o.onload=function(){$("#user_avatar").attr("src",this.result)},o.readAsDataURL(s.getSource().getSource())})}function a(e,s,o){var a=JSON.parse(o);n.avatar="http://7xs7nv.com1.z0.glb.clouddn.com/"+a.key,$("#progress").html(s.name+"上传成功！"),t=!0,console.log(a)}var n=user,t=!0;$("#user_sex").val(n.sex),$("#btn_update_message").on("click",function(){var s=$("#user_name").val(),o=$("#user_mobile").val();return s?o?(n.name=s,n.mobile=o,n.sex=$("#user_sex").val(),n.birthday=$("#user_birthday").val(),console.log(n),t?$.post("/users/update",n,function(e){alert(e),location.reload()}):e.shake("#btn_update_message"),!1):void e.shake("#user_mobile"):void e.shake("#user_name")}),$("#btn_reset_password").on("click",function(){$(".panel_reset_password").addClass("show")}),$("#btn_reset_password_1").on("click",function(){console.log("重置");var o=$("#old_password").val(),a=$("#new_password_1").val(),n=$("#new_password_2").val();return o?!a||a.length<6?void e.shake("#new_password_1"):n?a!==n?(e.shake("#new_password_1"),void e.shake("#new_password_2")):void $.post("/users/resetPassword",{oldPassword:o,newPassword1:a,newPassword2:n},function(e){alert(e),s()}):void e.shake("#new_password_2"):void e.shake("#old_password")}),$("#btn_reset_password_2").on("click",function(){s()});var r=$("#progress");$.get("/qiniu/token",function(s){e.initQiniu(s,"btn_add_avatar","头像","jpg,png",o,a,r)}),$.get("/models/userfind",function(e){if(console.log(e),0!==e.length){var s=$.tpl("tpl",{model:e});$(".user-model-list").html(s)}else $(".user-model-list").html("您还没上传作品")}),$("body").on("click",".model-delete",function(){var e=$(this).data("id"),s=$(this).data("name"),o=$(this);confirm("确认删除模型【"+s+"】")&&$.post("/models/web/delete_model/"+e,function(e){alert(s+e),o.parents(".col-md-4").remove()})})});